<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>{% block title %}Internet Tracker{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3"></script>
  <script src="https://ssl.gstatic.com/trends_nrtr/4116_RC01/embed_loader.js"></script>
  <script>
    // Google Trends fallback and initialization
    window.trends = window.trends || {};
    
    // Wait for Google Trends to load, with timeout
    let trendsLoaded = false;
    const trendsTimeout = setTimeout(() => {
      if (!trendsLoaded) {
        console.warn('Google Trends failed to load, using fallback');
        initTrendsFallback();
      }
    }, 5000);
    
    // Check if trends loaded successfully
    if (window.trends && window.trends.embed && typeof window.trends.embed.renderExploreWidgetTo === 'function') {
      trendsLoaded = true;
      clearTimeout(trendsTimeout);
    } else {
      // Fallback implementation
      initTrendsFallback();
    }
    
    function initTrendsFallback() {
      window.trends.embed = {
        renderExploreWidgetTo: function(target, type, config, ui) {
          const iframe = document.createElement('iframe');
          const keyword = config.comparisonItem[0].keyword;
          const geo = config.comparisonItem[0].geo;
          const time = config.comparisonItem[0].time || 'today 3-m';
          
          iframe.src = `https://trends.google.com/trends/embed/explore?date=${encodeURIComponent(time)}&geo=${geo}&q=${encodeURIComponent(keyword)}&hl=en`;
          iframe.width = '100%';
          iframe.height = '400';
          iframe.style.border = 'none';
          iframe.title = `Google Trends for ${keyword}`;
          iframe.style.borderRadius = '8px';
          iframe.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
          
          target.appendChild(iframe);
        }
      };
    }
  </script>
  <style>
    .card{ background:#fff;border-radius:1rem;box-shadow:0 1px 3px rgba(0,0,0,.08);padding:1.25rem }
    .h2{ font-weight:600;font-size:1.125rem }
    .muted{ color:#6b7280;font-size:.875rem }
    .badge{ display:inline-block;background:#f3f4f6;color:#374151;padding:.25rem .5rem;border-radius:.375rem;font-size:.75rem }
    .spinner{ width:18px;height:18px;border:3px solid #ddd;border-top-color:#555;border-radius:50%;animation:spin .8s linear infinite;display:inline-block }
    @keyframes spin{ to{ transform:rotate(360deg) } }
    #httpLoading, #l3Loading { display: block; }
    .chart-container { position: relative; }
    #trendsEmbed { min-height: 340px; }
    .scroll-y-300 { max-height: 300px; overflow-y: auto; }
    .age-gate-yes { background: rgba(239, 68, 68, 0.1); border-left: 4px solid #ef4444; }
    .age-gate-no { background: rgba(34, 197, 94, 0.1); border-left: 4px solid #22c55e; }
    .age-gate-unknown { background: rgba(107, 114, 128, 0.1); border-left: 4px solid #6b7280; }
    .tor-png-container { transition: all 0.2s ease; }
    .tor-png-container:hover { transform: scale(1.02); }
    .tor-png-container img { max-width: 100%; height: auto; }
    
    /* Trends improvements */
    .trends-loading { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      min-height: 200px; 
      color: #6b7280; 
    }
    .trends-error { 
      background: #fef2f2; 
      border: 1px solid #fecaca; 
      border-radius: 8px; 
      padding: 1rem; 
      text-align: center; 
      color: #dc2626; 
    }
    .trends-fallback { 
      background: #f0f9ff; 
      border: 1px solid #bae6fd; 
      border-radius: 8px; 
      padding: 1rem; 
      text-align: center; 
      color: #0369a1; 
    }
  </style>
  {% block extra_head %}{% endblock %}
</head>
<body class="bg-gray-50 text-gray-900">
  {% block content %}{% endblock %}
  
  {% block scripts %}{% endblock %}
</body>
</html>
